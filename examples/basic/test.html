<!DOCTYPE html>
<html>
    <head>
        <title>Bid.io Test</title>
    </head>
    <body>
        <p>
            <input id="message" type="text">
            <input id="send" type="submit" value="Send">
        </p>

        <ul id="messages"></ul>
        <table id="bidMatrix" border="1">
            <tr>
                <th colspan="22" id="local">&nbsp;</th>
                <th colspan="22" id="global">&nbsp;</th>
            </tr>
        </table>  

        <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script src="/bid.io.js"></script>
        
        <script>
        var counter=0;
        var cobbS=new Array();
        $.getJSON("channels.json", function(data) {
            channelList=data;
            //console.log(typeof data);
            newRows='<tr>';
                    /*<td colspan=10>1</td>\n\
                    <td colspan=10></td>\n\
                    <td colspan=10></td>\n\
                    <td colspan=10></td>\n\
                    </tr><tr>';
            */
            
            
            for (var key in data){
                if(key!= 0) {
                    
                cobbS[key]=bio.join(key);
                cobbS[key].watch( function (data, action) {
                    console.log('WATCHING: ', action, data);
                })

                if(counter %4 == 0 ) {
                    newRows+='</tr>';
                    $('#bidMatrix tr:last').after(newRows);
                    //console.log(counter);
                    newRows='<tr>';
                }
                //console.log(data[key])
                newRows+='<td>'+data[key]+'</td>';
                for(rows=1;rows<=10;rows++){     
                    //console.log(key);
                    newRows+='<td onclick="doClick('+key+','+rows+');" id="td'+(rows)+'">'+(rows)+'</td>';
                }
                counter++;
                }//if key not 0
            }
            newRows+="</tr>";
        $('#bidMatrix tr:last').after(newRows);
             
        });

        bio = bio(io, 'http://'+window.location.hostname+':3000');

        var Cobb = bio.join(32);
            
        Cobb.watch( function (data, action) {
            console.log('WATCHING: ', action, data);
        })
        
        Cobb.watch(7, function (data, action) {
            console.log('WATCHING: ', action, data);
        })

        
        Cobb.fetch(7, function (err, res) {
            console.log('FETCHING', arguments);
            console.log(res);
        });


        Cobb.open(6, { id: 12345, name: 'Jonathan' }, function (err, res) {
            console.log(arguments);
        });
        //Cobb.query(6);


        Cobb.on('connect', function () {
            console.log('CONNECTED', arguments);
        })

        Cobb.on('disconnect', function () {
            console.log('DISCONNECT', arguments);
        })

        Cobb.on('reconnect', function () {
            console.log('RECONNECT', arguments);
        });

        var socket = bio.connect();

        socket.on('connect', function () {
            console.log('CONNECTED TO REGULAR SOCKET');

            socket.emit('hi');
            socket.on('hi', function (data) {

                console.log('============ HI =============');
            });
        })
        function doClick(countyId, bidId) {
            cobbS[countyId].open(bidId, { id: bidId, name: 'some bidder#'+bidId }, function (err, res) {
            console.log(arguments);
            $('#local').html(" >> "+countyId+":"+bidId+" << ");
        });
            
        }
        </script>
    </body>
</html>