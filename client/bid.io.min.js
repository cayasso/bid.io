(function(){function b(a){return b.enabled(a)?function(c){var d=new Date,e=d-(b[a]||d);b[a]=d,c=a+" "+c+" +"+b.humanize(e),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function c(b,d){var e=c.resolve(b),f=c.modules[e];if(!f)throw new Error('failed to require "'+b+'" from '+d);return f.exports||(f.exports={},f.call(f.exports,f,f.exports,c.relative(e),a)),f.exports}var a=this;b.names=[],b.skips=[],b.enable=function(a){localStorage.debug=a;var c=(a||"").split(/[\s,]+/),d=c.length;for(var e=0;e<d;e++)a=c[e].replace("*",".*?"),a[0]==="-"?b.skips.push(new RegExp("^"+a.substr(1)+"$")):b.names.push(new RegExp("^"+a+"$"))},b.disable=function(){b.enable("")},b.humanize=function(a){var b=1e3,c=6e4,d=60*c;return a>=d?(a/d).toFixed(1)+"h":a>=c?(a/c).toFixed(1)+"m":a>=b?(a/b|0)+"s":a+"ms"},b.enabled=function(a){for(var c=0,d=b.skips.length;c<d;c++)if(b.skips[c].test(a))return!1;for(var c=0,d=b.names.length;c<d;c++)if(b.names[c].test(a))return!0;return!1},window.localStorage&&b.enable(localStorage.debug),c.modules={},c.resolve=function(a){var b=a,d=a+".js",e=a+"/index.js";return c.modules[d]&&d||c.modules[e]&&e||b},c.register=function(a,b){c.modules[a]=b},c.relative=function(a){return function(d){if("debug"==d)return b;if("."!=d.charAt(0))return c(d);var e=a.split("/"),f=d.split("/");e.pop();for(var g=0;g<f.length;g++){var h=f[g];".."==h?e.pop():"."!=h&&e.push(h)}return c(e.join("/"),a)}},c.register("channel.js",function(a,b,c,d){function t(a,b){e.call(this,{delimiter:o,wildcard:!0}),this.primus=b.primus,this.ns=b.ns||"stream",this.name=a,this.evts={},this.connect()}var e=c("./eventemitter2").EventEmitter2,f=c("debug")("bid.io-client:channel"),g=c("./parser"),h=c("./url"),i=g.encode,j=g.decode,k=g.packets,l=[].slice,m,n=Array.isArray?Array.isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},o="::",p="*",q=["message","close","connect","connecting","connect_failed","reconnect","reconnecting","reconnect_failed","disconnect"],r=["fetch","query","lock","unlock","pending","complete","error","update"],s=new RegExp("^("+r.join("|")+")$");a.exports=t,t.prototype.__proto__=e.prototype,t.prototype.connect=function(){var a=this,b=q.length;this.spark=this.primus.channel(this.name);for(var c=0;c<b;c++)this.bind(q[c]);return this.spark.on(this.ns,function(b){a.onstream.call(a,b)}),this},t.prototype.onstream=function(a){var b=j(a),c=b.id,d=b.type,e=b.data,f=this.ns+o+(c||p)+o+d;return this.emit(f,e,d),this},t.prototype.bind=function(a){var b=this;return this.evts[a]=function(){var c=l.call(arguments);b.emit.apply(b,[a].concat(c))},b.spark.on(a,this.evts[a]),this},t.prototype.unbind=function(a){return this.spark.removeListener(a,this.evts[a]),this},t.prototype.disconnect=function(){var a=q.length;for(var b=0;b<a;b++)this.unbind(q[b]),this.spark.disconnect();return this},t.prototype.watch=function(a,b,c){return this._watch(a,b,"on",c)},t.prototype.unwatch=function(a,b,c){return this._watch(a,b,"off",c)},t.prototype._watch=function(a,b,c,d){var e,f;"function"==typeof a?(d=a,b=p,a=p):n(a)||s.test(a)||~(a+"").indexOf(" ")?(d=b,b=a,a=p):"function"==typeof b?(d=b,b=p):a||(a=p),e=this.ns+o+a+o,"off"===c&&!d&&(c="removeAllListeners"),b&&(n(b)?f=b:"string"==typeof b&&p!==b&&(f=b.split(" ")));if(f){var g=f.length;for(var h=0;h<g;h++){b=f[h];if(!s.test(b))continue;this[c](e+b,d)}}else this[c](e+p,d);return this},t.prototype.find=function(a,b){return this.send("query","",a,b)},t.prototype.open=function(a,b,c){return this.send("lock",a,b,c)},t.prototype.cancel=function(a,b,c){return this.send("unlock",a,b,c)},t.prototype.send=function(a,b,c,d){var e;"function"==typeof c&&(d=c,c=null),e="query"===a?{query:c}:"update"===a?{update:c}:{owner:c};var f=i({type:a,id:b,data:e});return this.request(f,d),this},t.prototype.request=function(a,b){return this.spark.emit(this.ns,a,this.response(b)),this},t.prototype.response=function(a){return function(b){var c=j(b);"error"==c.type?a&&a(c.data):a&&a(null,c.data)}},["claim","fetch","complete","pending","update","forceunlock"].forEach(function(a){t.prototype[a]=function(){var b=l.call(arguments);this.send.apply(this,[a].concat(b))}})}),c.register("eventemitter2.js",function(a,b,c,d){function g(){this._events={},this._conf&&h.call(this,this._conf)}function h(a){a&&(this._conf=a,a.delimiter&&(this.delimiter=a.delimiter),a.maxListeners&&(this._events.maxListeners=a.maxListeners),a.wildcard&&(this.wildcard=a.wildcard),a.newListener&&(this.newListener=a.newListener),this.wildcard&&(this.listenerTree={}))}function i(a){this._events={},this.newListener=!1,h.call(this,a)}function j(a,b,c,d){if(!c)return[];var e=[],f,g,h,i,k,l,m,n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if(typeof c._listeners=="function")return a&&a.push(c._listeners),[c];for(f=0,g=c._listeners.length;f<g;f++)a&&a.push(c._listeners[f]);return[c]}if(o==="*"||o==="**"||c[o]){if(o==="*"){for(h in c)h!=="_listeners"&&c.hasOwnProperty(h)&&(e=e.concat(j(a,b,c[h],d+1)));return e}if(o==="**"){m=d+1===n||d+2===n&&p==="*",m&&c._listeners&&(e=e.concat(j(a,b,c,n)));for(h in c)h!=="_listeners"&&c.hasOwnProperty(h)&&(h==="*"||h==="**"?(c[h]._listeners&&!m&&(e=e.concat(j(a,b,c[h],n))),e=e.concat(j(a,b,c[h],d))):h===p?e=e.concat(j(a,b,c[h],d+2)):e=e.concat(j(a,b,c[h],d)));return e}e=e.concat(j(a,b,c[o],d+1))}i=c["*"],i&&j(a,b,i,d+1),k=c["**"];if(k)if(d<n){k._listeners&&j(a,b,k,n);for(h in k)h!=="_listeners"&&k.hasOwnProperty(h)&&(h===p?j(a,b,k[h],d+2):h===o?j(a,b,k[h],d+1):(l={},l[h]=k[h],j(a,b,{"**":l},d+1)))}else k._listeners?j(a,b,k,n):k["*"]&&k["*"]._listeners&&j(a,b,k["*"],n);return e}function k(a,b){a=typeof a=="string"?a.split(this.delimiter):a.slice();for(var c=0,d=a.length;c+1<d;c++)if(a[c]==="**"&&a[c+1]==="**")return;var g=this.listenerTree,h=a.shift();while(h){g[h]||(g[h]={}),g=g[h];if(a.length===0){if(!g._listeners)g._listeners=b;else if(typeof g._listeners=="function")g._listeners=[g._listeners,b];else if(e(g._listeners)){g._listeners.push(b);if(!g._listeners.warned){var i=f;typeof this._events.maxListeners!="undefined"&&(i=this._events.maxListeners),i>0&&g._listeners.length>i&&(g._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",g._listeners.length),console.trace())}}return!0}h=a.shift()}return!0}var e=Array.isArray?Array.isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},f=10;i.prototype.delimiter=".",i.prototype.setMaxListeners=function(a){this._events||g.call(this),this._events.maxListeners=a,this._conf||(this._conf={}),this._conf.maxListeners=a},i.prototype.event="",i.prototype.once=function(a,b){return this.many(a,1,b),this},i.prototype.many=function(a,b,c){function e(){--b===0&&d.off(a,e),c.apply(this,arguments)}var d=this;if(typeof c!="function")throw new Error("many only accepts instances of Function");return e._origin=c,this.on(a,e),d},i.prototype.emit=function(){this._events||g.call(this);var a=arguments[0];if(a==="newListener"&&!this.newListener&&!this._events.newListener)return!1;if(this._all){var b=arguments.length,c=new Array(b-1);for(var d=1;d<b;d++)c[d-1]=arguments[d];for(d=0,b=this._all.length;d<b;d++)this.event=a,this._all[d].apply(this,c)}if(a==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var e;if(this.wildcard){e=[];var f=typeof a=="string"?a.split(this.delimiter):a.slice();j.call(this,e,f,this.listenerTree,0)}else e=this._events[a];if(typeof e=="function"){this.event=a;if(arguments.length===1)e.call(this);else if(arguments.length>1)switch(arguments.length){case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:var b=arguments.length,c=new Array(b-1);for(var d=1;d<b;d++)c[d-1]=arguments[d];e.apply(this,c)}return!0}if(e){var b=arguments.length,c=new Array(b-1);for(var d=1;d<b;d++)c[d-1]=arguments[d];var h=e.slice();for(var d=0,b=h.length;d<b;d++)this.event=a,h[d].apply(this,c);return h.length>0||this._all}return this._all},i.prototype.on=function(a,b){if(typeof a=="function")return this.onAny(a),this;if(typeof b!="function")throw new Error("on only accepts instances of Function");this._events||g.call(this),this.emit("newListener",a,b);if(this.wildcard)return k.call(this,a,b),this;if(!this._events[a])this._events[a]=b;else if(typeof this._events[a]=="function")this._events[a]=[this._events[a],b];else if(e(this._events[a])){this._events[a].push(b);if(!this._events[a].warned){var c=f;typeof this._events.maxListeners!="undefined"&&(c=this._events.maxListeners),c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}}return this},i.prototype.onAny=function(a){this._all||(this._all=[]);if(typeof a!="function")throw new Error("onAny only accepts instances of Function");return this._all.push(a),this},i.prototype.addListener=i.prototype.on,i.prototype.off=function(a,b){if(typeof b!="function")throw new Error("removeListener only takes instances of Function");var c,d=[];if(this.wildcard){var f=typeof a=="string"?a.split(this.delimiter):a.slice();d=j.call(this,null,f,this.listenerTree,0)}else{if(!this._events[a])return this;c=this._events[a],d.push({_listeners:c})}for(var g=0;g<d.length;g++){var h=d[g];c=h._listeners;if(e(c)){var i=-1;for(var k=0,l=c.length;k<l;k++)if(c[k]===b||c[k].listener&&c[k].listener===b||c[k]._origin&&c[k]._origin===b){i=k;break}if(i<0)continue;return this.wildcard?h._listeners.splice(i,1):this._events[a].splice(i,1),c.length===0&&(this.wildcard?delete h._listeners:delete this._events[a]),this}if(c===b||c.listener&&c.listener===b||c._origin&&c._origin===b)this.wildcard?delete h._listeners:delete this._events[a]}return this},i.prototype.offAny=function(a){var b=0,c=0,d;if(a&&this._all&&this._all.length>0){d=this._all;for(b=0,c=d.length;b<c;b++)if(a===d[b])return d.splice(b,1),this}else this._all=[];return this},i.prototype.removeListener=i.prototype.off,i.prototype.removeAllListeners=function(a){if(arguments.length===0)return!this._events||g.call(this),this;if(this.wildcard){var b=typeof a=="string"?a.split(this.delimiter):a.slice(),c=j.call(this,null,b,this.listenerTree,0);for(var d=0;d<c.length;d++){var e=c[d];e._listeners=null}}else{if(!this._events[a])return this;this._events[a]=null}return this},i.prototype.listeners=function(a){if(this.wildcard){var b=[],c=typeof a=="string"?a.split(this.delimiter):a.slice();return j.call(this,b,c,this.listenerTree,0),b}return this._events||g.call(this),this._events[a]||(this._events[a]=[]),e(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},i.prototype.listenersAny=function(){return this._all?this._all:[]},b.EventEmitter2=i}),c.register("index.js",function(a,b,c,d){function h(a,b,c){return c=c||{},new e(a,b,c)}var e=c("./manager"),f=c("./channel"),g=c("./parser");a.exports=b=h,b.protocol=g.protocol,b.Manager=e,b.Channel=f}),c.register("manager.js",function(a,b,c,d){function h(a){this.primus=a,this.chnls={}}var e=c("./channel"),f=c("debug")("bid.io-client:manager"),g="force new connection";a.exports=h,h.prototype.join=function(a,b){b=b||{},f("joining channel %s",a);var c=this.chnls[a];return c?c:(c=new e(a,this),this.chnls[a]=c,c)},h.prototype.leave=function(a){var b=this.chnls[a];return b?(f("disconnecting from channel %s",a),b.disconnect(),delete this.chnls[a]):f("unable to find channel %s",a),this},h.prototype.getChannel=function(a){var b=this.chnls[a];return b?b:f("Channel '%s' doesn't exist.",a)}}),c.register("parser.js",function(a,b,c,d){function i(a){if(Object.keys)return Object.keys(a);var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}var e=c("debug")("bid.io-parser");b.protocol=1;var f=b.packets={fetch:0,query:1,lock:2,unlock:3,pending:4,complete:5,claim:6,forceunlock:7,error:8,update:9},g=b.packetslist=i(f),h={type:"error",data:"parser error"};b.encode=function(a){var b="";return b+=f[a.type],null!=a.id&&(b+=a.id),null!=a.data&&(b+=JSON.stringify(a.data)),e("encoded %j as %s",a,b),b},b.decode=function(a){var b={},c=0;if(null==a)return h;b.type=g[Number(a.charAt(0))];if(null==b.type)return h;var d=a.charAt(c+1);if(""!=d&&Number(d)==d){b.id="";while(++c){var f=a.charAt(c);if(null==f||Number(f)!=f){--c;break}b.id+=a.charAt(c);if(c+1==a.length)break}}if(a.charAt(++c))try{b.data=JSON.parse(a.substr(c))}catch(i){return h}return e("decoded %s as %j",a,b),b}}),c.register("url.js",function(a,b,c,d){function g(a){var b=e.exec(a||""),c={},d=14;while(d--)c[f[d]]=b[d]||"";return c}b.parse=g;var e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"]});var d=c("index.js");"undefined"!=typeof module?module.exports=d:bio=d})();